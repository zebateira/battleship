\begin{vdm_al}
class Ship
 types
  
 values
  public static ORIENTATION_UP : int = 0;
  public static ORIENTATION_RIGHT : int = 1;
  public static ORIENTATION_DOWN : int = 2;
  public static ORIENTATION_LEFT : int = 3;
  
  static orientations : map int to (seq of int) = {
   ORIENTATION_UP  |-> [ 0,-1],
   ORIENTATION_RIGHT |-> [+1, 0],
   ORIENTATION_DOWN |-> [ 0,+1],
   ORIENTATION_LEFT |-> [-1, 0]
  };

 instance variables
 
  public static id : int := 0;
  public coord_init : House`coords;
  public coords : set of House`coords := {};
  public orientation : int := 1;
  public hits : int := 0;
  public size: int := 1;
  public board: Board;
  public my_id: int;
  
  inv checkOrientation(orientation);
  inv len coord_init = 2;
  inv id >= 0;
  inv card(coords) >= 0 and card(coords) <= size;
 
 operations
 
 public Ship: House`coords * int * int * Board ==> Ship
 Ship(c,o,s,b) == 
 (
  coord_init := c;
  size := s;
  coords := {c};
  orientation := o;
  board := b;
  my_id := id +1;
  id := my_id;
  
  for i = 1 to size-1 do ( 
   coords := coords union {[c(1)+orientations(o)(1)*i,c(2)+orientations(o)(2)*i]};
  );
  
 )
 pre forall x in set {c(1),c(1)+orientations(o)(1)*(s-1)}, y in set {c(2),c(2)+orientations(o)(2)*(s-1)} &
   House`checkCoords([x] ^ [y])
 post fill_houses();
 
 public fill_houses: ()==> bool
  fill_houses() ==
  (
   for all c in set coords do
   (
    let h in set board.houses be st h.x = c(1) and h.y = c(2) in
    (
     h.hasShip := true;
     h.ship := self;
    )
   );
   return true;
  )
 pre forall c in set coords &
  let h in set board.houses be st h.x = c(1) and h.y = c(2) in
  (
   not h.hasShip
  );

 public inc: () ==> ()
  inc() == hits := hits +1
 pre hits < size
 post hits <= size;
 
 public isDown : () ==> bool
  isDown() == return size = hits;
  
 functions
  public static checkOrientation : int -> bool
   checkOrientation(orientation) ==
    orientation in set {ORIENTATION_UP, ORIENTATION_RIGHT, ORIENTATION_DOWN, ORIENTATION_LEFT};
end Ship
\end{vdm_al}
\bigskip
\begin{longtable}{|l|r|r|}
\hline
Function or operation & Coverage & Calls \\
\hline
\hline
Ship & 100.0\% & 40 \\
\hline
checkOrientation & 100.0\% & 120 \\
\hline
fill\_houses & 100.0\% & 40 \\
\hline
inc & 100.0\% & 72 \\
\hline
isDown & 100.0\% & 383 \\
\hline
\hline
Ship.vdmpp & 100.0\% & 655 \\
\hline
\end{longtable}

